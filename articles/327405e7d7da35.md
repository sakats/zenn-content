---
title: "君は「マシンイプシロン」を知っているか"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Python","float","浮動小数点"]
published: false
---

# はじめに
皆さんは「マシンイプシロン」または「計算機イプシロン」を知ってますか？
先日書いたコードで概念を知って、浮動小少数点数の世界と少し仲良くなれました。
個人的にとても勉強になったので記事にまとめてみます！

# 対象読者
* マシンイプシロンを知らない人
* 浮動小数点型、その計算について学習したい人

# マシンイプシロンの定義
まずはマシンイプシロンの定義です。Wikipediaの引用です。
>計算機イプシロン（けいさんきイプシロン、英: machine epsilon）は、浮動小数点数において、「1より大きい最小の数」と1との差のことである。
>機械イプシロン（きかいイプシロン）とも言う。

https://ja.wikipedia.org/wiki/%E8%A8%88%E7%AE%97%E6%A9%9F%E3%82%A4%E3%83%97%E3%82%B7%E3%83%AD%E3%83%B3

# なんの役に立つのか？
マシンイプシロンこと「1より大きい最小の数」はなんの役に立つのでしょうか？
定義を見ただけではイメージしにくいので、一例として浮動小数点型の一致判定プログラムを書いていきます。

# Pythonでマシンイプシロンを確認
まずはマシンイプシロンを出力してみます。
Pythonでは標準ライブラリ`sys`から参照可能です。
```python
>>>import sys
>>>print(sys.float_info.epsilon)  
2.220446049250313e-16

>>> type(sys.float_info.epsilon) 
<class 'float'>
```
値は2.220446049250313e-16（0.0000000000000002204...）
型はfloatのようです！

# 浮動小数点の一致判定プログラム
下記がマシンイプシロンの利用例です。
2つの浮動小数点型変数が同じ値か判定しています。
```python
x = 1.0
y = 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1 + 0.1

print(f"x is {x}") # x is 1.0
print(f"y is {y}") # y is 0.9999999999999999

print(x == y) # False
print(x - y <= sys.float_info.epsilon * max(abs(x),abs(y))) # True
```

変数yを見てみましょう。0.1を10回加算した値を代入しました。
それって1.0じゃないの...？と思いますが、出力結果は想定外の数値です。

この現象は数値計算の際に、10進数の0.1を2進数に変換する影響で発生しています。
2進数では0.1を表現できず、ちょうど良い数字にならないため丸め誤差が発生してしまいます。
限りなく0.1に近い、別の数字を10回加算したら0.9999999999...になってしまったという状態です。

このような誤差が発生しても、極々微小な差であれば同一の値と判定したいので
2つの数字の差とマシンイプシロンを比較しています。
このプログラムはgithubにアップ済です。

# 2進数で0.1を少数で表現できないってどういうこと？
循環小数になってしまう
pythonのfloatは多倍長浮動小数点型。64bitで浮動少数点数を表す。
仮数部Xbit,指数部Xbit

# おまけ：Pythonでマシンイプシロンを求めてみる
今回はpythonの標準ライブラリからマシンイプシロンを使いました。
おまけでマシンイプシロンを求めるプログラムも書いて見ようと思います。

他言語でもマシンイプシロンはライブラリから参照できることが多いですが、
いつかどこかで役にたつかもしれません...。
```python
machine_epsilon = 
```
ここに注意のマークダウン！
学習にあたって情報収集していたところ、マシンイプシロンの概念を間違えている記事を多く見かけました。

>計算機イプシロンは「最小の（正の）浮動小数点数」ではありません。

>計算機イプシロンは，しばしば「浮動小数点で表せる0より大きい最小の数」と誤解されます。
>もしこのような定義だと，指数部分を小さくすることで仮数部分の精度に関係なく小さな値を表現できてしまうことになります。

# 参考記事
深く学習したい方に、下記の記事をオススメします。ぜひご一読ください。
https://zenn.dev/mod_poppo/articles/floating-point-relative-error
