---
title: "Pythonの「仮想環境」「パッケージインストーラー」って？"
emoji: "😽"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
# 概要
pythonの仮想環境・パッケージ管理についてしらべていると、
venvとかpipの役割がごちゃついたので整理する

今回は下記を前提
仮想環境：venv
パッケージ管理：pip

## 仮想環境とバージョン管理はやりたいことが違う
仮想環境
・プロジェクトごとに環境を分ける事ができる
　pythonのバージョンやパッケージのバージョンなど。
・試してみたいパッケージ用に、使い捨ての環境を作れる。

バージョン管理(pip？)
・インタプリタ切替 (Pythonのバージョンを切り替える)
・パッケージ切替 (パッケージのバージョンを切り替える)
・パッケージインストール (パッケージをインストールする)
・リポジトリ (パッケージのインストール元)

参照：[Pythonのパッケージ管理ベストプラクティス](https://qiita.com/c60evaporator/items/b6a7394231d1e768ce64#%E5%BF%85%E8%A6%81%E7%9F%A5%E8%AD%98)
これの○×表が理解できるようになれば...。

## 仮想環境ツールにもいろいろある
### venv
・virtualenvからvenvが派生して生まれた。
・Python3.5以降のPython公式に付属する推奨仮想環境で、信頼性が高いドキュメントが多い。（資格試験はこっち）
・Python 3.x.x 下に組み込まれた機能なので、Python自体のバージョン管理や切り替えができない。
https://docs.python.org/ja/3/library/venv.html

### virtualenv
・python2系で使われていた。
・venvに派生したが、開発は続いている。
・Pythonに組み込まれていないので、バージョンの切り替えができる。
https://virtualenv.pypa.io/en/stable/index.html（ドキュメントがpython.orgから外れている）

### conda
### pyenv

# パッケージについて調べたあれこれ
パッケージングって？
https://blog.recruit.co.jp/rls/2019-12-25-python-packaging-specs/
・平たく言えばライブラリなど、配布プログラム
・Python には sdist と bdist という2種類のパッケージ配布形式がある
・bdistは置くだけでインストールできるようになっている
・sdistはzip/tar.gzで配布して、インストール時にビルドが必要なモノ

PyPA(Python Packaging Authority)
https://www.pypa.io/en/latest/
・Pythonのパッケージングに関するツールを作成している団体
・pipを開発した団体

pipとは
・PyPAが開発したパッケージインストーラー
・pipそのものは標準ライブラリではないが、pipのインストーラーが標準で組み込まれている。
  https://peps.python.org/pep-0453/
  (ややこしい...)

pipでできる事
・パッケージングに関する改善に、PyPA以外のコミュニティが貢献できない！という問題が発生
・pipのインストール方法が色々追加された。
https://packaging.python.org/ja/latest/guides/installing-using-pip-and-virtual-environments/
・バージョン管理システム（git）経由
・requirementsファイル経由


# 後輩君Q

* 仮想環境作成、有効化、pip実行に順番は関係あるの？
　仮想環境作成後、pipしてから有効化って駄目なことあるの？
* apacheからpythonを実行したいとき、仮想環境を使えていないみたい。こんな時はどうすればいいの？
* ライブラリのバージョンの違いが必要なケースってあるの？どんな時？ 

## 回答するために理解すべき事まとめ

### venvで仮想環境「作成」「有効化」何が起きているのか調べる
1. 初期状態
Pythonプロジェクトファイルがある状態。動く~.pyがある。
1. 仮想環境の作成
`python -m venv /path/to/new/virtual/environment`
上記コマンドを実行すると、対象ディレクトリ（とその親ディレクトリ）が作成され、その中に pyvenv.cfg ファイルが置かれます。 
1. 仮想環境の有効化
仮想環境は、そのバイナリディレクトリ (POSIX では bin、Windows では Scripts) の中にあるスクリプトを使って「アクティベート (activate)」することができる。
>Python を呼び出すときに仮想環境の Python インタプリタへのフルパスを指定すれば良いだけなので、仮想環境をアクティベートする 必要 はありません。さらに、仮想環境にインストールされたすべてのスクリプトはアクティベートせずとも実行可能なはずです。

とあるので、有効化＝使いやすくするための儀式的な奴だった。

>これを達成するため、仮想環境にインストールされたスクリプトは、仮想環境の Python インタプリタを指し示す "shebang" の行を含みます i.e. #!/<path-to-venv>/bin/python 。つまり、PATH の値に関係なくそのスクリプトはそのインタプリタを使って実行されます。Windows では、"shebang" の行の処理は Windows の Python ランチャ がインストールされていれば可能です。したがって、Windows のエクスプローラのウィンドウで、インストールされたスクリプトをダブルクリックすると、仮想環境をアクティベートしたり PATH を編集したりしなくても、正しいインタプリタでスクリプトが実行されるはずです。

ここがよくわからない。
深堀するために調べる事は下記
・Python インタプリタを指し示す "shebang" 
・インタプリタ指定 ＝ 利用ライブラリの指定？
・importは何依存で参照先を決定するのか
・仮説：インタプリタ(python.exe)からライブラリを判定
　この場合、違うフォルダのクラス、subprosess経由で呼ばれた時の挙動はどうなる？

### 実際にやってみてファイルの中身を確認する

### 仮想環境が有効化・無効化している状態ではpipがどこにファイルを落とすのか

## apache環境でうまく動作しなかった理由

下記の記事を見てやった所、Pythonで利用するインタプリタが指定されていたから。
https://sakusaku-techs.com/apache-tomcat/cgi/
